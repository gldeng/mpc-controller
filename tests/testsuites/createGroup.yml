name: Create group test suite

vars:
  ROLE_DEFAULT_ADMIN: 0x8db97C7cEcE249c2b98bDC0226Cc4C2A57BF52FC
  ROLE_DEFAULT_ADMIN_PK: 56289e99c94b6912bfc12adc093c9b51124f0dc54ac7a766b2bc5ccf558d8027
  C_CHAIN_RPC_URL: http://127.0.0.1:9650/ext/bc/C/rpc
  MPC_PLAYER_PUBKEYS: ["0xc20e0c088bb20027a77b1d23ad75058df5349c7a2bfafff7516c44c6f69aa66defafb10f0932dc5c649debab82e6c816e164c7b7ad8abbe974d15a94cd1c2937","0xd0639e479fa1ca8ee13fd966c216e662408ff00349068bdc9c6966c4ea10fe3e5f4d4ffc52db1898fe83742a8732e53322c178acb7113072c8dc6f82bbc00b99","0x73ee5cd601a19cd9bb95fe7be8b1566b73c51d3e7e375359c129b1d77bb4b3e6f06766bde6ff723360cee7f89abab428717f811f460ebf67f5186f75a9f4288d","0x8196e06c3e803d0af06693a504ad14317550b4be4396ef57cf5f520c0f84833db8ed1056383ea329b8586cb62c37d80a3d7bb80742bc1bec6d650e6632a62905","0x3217bb0e66dda25bcd50e2ccebabbe599312ae69c76076dd174e2fc5fdae73d8bdd1c124d85f6c0b10b6ef24460ff4acd0fc2cd84bd5b9c7534118f472d0c7a1","0xdf7fb5bf5b3f97dffc98ecf8d660f604cad76f804a23e1b6cc76c11b5c92f3456dab26cdf995e6cb7cf772ba892044da9c64b095db7725d9e3c306c484cf54e2","0x72eab231c150b42e86cbe7398139432d2cad04289a820a922fe17b9d4ba577f4d3c33a90bd5b304344e1bea939ef7d16f428d50d25cada4225d9299d35ef1644"]

testcases:
  - name: readMpcManagerAddress
    steps:
      - type: readfile
        path: MYHOME/mpctest/contracts/addresses/MPC_MANAGER_ADDRESS
        vars:
          content:
            from: result.content
        assertions:
          - result.content ShouldNotBeEmpty

  - name: Create a new group of 7 participants with threshold 4
    steps:
      - script: cast send --rpc-url {{.C_CHAIN_RPC_URL}} --from {{.ROLE_DEFAULT_ADMIN}} --private-key {{.ROLE_DEFAULT_ADMIN_PK}} --gas-limit 900000 {{.readMpcManagerAddress.content}} "createGroup(bytes[],uint256)" {{.MPC_PLAYER_PUBKEYS}} 4
        assertions: # todo: to improve assertion with getGroup, plus check ParticipantAdded event, both of which should be reflected in mpc-controller.
          - result.systemout ShouldNotBeEmpty